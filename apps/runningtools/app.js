!function(){"use strict";var t,e,n,a,s;!function(t){t[t.BTN1=1]="BTN1",t[t.BTN2=2]="BTN2",t[t.BTN3=3]="BTN3",t[t.BTN4=4]="BTN4",t[t.BTN5=5]="BTN5"}(t||(t={})),function(t){t[t.Stop=1]="Stop",t[t.Pause=2]="Pause",t[t.Run=3]="Run"}(e||(e={})),function(t){t[t.Running=1]="Running",t[t.Heart=2]="Heart",t[t.Map=3]="Map",t[t.Gps=4]="Gps"}(n||(n={})),function(t){t[t.Totals=1]="Totals",t[t.Partial=2]="Partial",t[t.Current=3]="Current",t[t.Health=4]="Health"}(a||(a={}));class r{constructor(){this._runningScreenData=a.Totals,this._steps=0,this._heart=0,this._speed=0,this._totalDistance=0,this._totalSpeed=0,this._totalIncrements=0,this._totalDuration=0,this._kilometerSpeed=0,this._kilometerDistance=0,this._kilometerIncrements=0,this._kilometerDuration=0,this._partialKilometerSpeed=0,this._partialKilometerDuration=0,this._screenType=n.Running,this._currentGpsData=null,this._previousGpsData=null,this._stateGps=!1,this._satellites=0,this._activityState=0,this._forceResetActivity=!1}resetRunnigActivity(){this.runningScreenData=a.Totals,this.steps=0,this.heart=0,this.speed=0,this.totalDistance=0,this.totalSpeed=0,this.totalIncrements=0,this.totalDuration=0,this.kilometerSpeed=0,this.kilometerDistance=0,this.kilometerIncrements=0,this.kilometerDuration=0,this.partialKilometerSpeed=0,this.partialKilometerDuration=0,this.activityState=e.Stop,this.forceResetActivity=!1}static getInstance(){return r._instance||(r._instance=new r),r._instance}get steps(){return this._steps}set steps(t){this._steps=t}get heart(){return this._heart}set heart(t){this._heart=t}get speed(){return this._speed}set speed(t){this._speed=t}get calories(){return this._calories}set calories(t){this._calories=t}get screenType(){return this._screenType}set screenType(t){this._screenType=t}get stateGps(){return this._stateGps}set stateGps(t){this._stateGps=t}get activityState(){return this._activityState}set activityState(t){this._activityState=t}get forceResetActivity(){return this._forceResetActivity}set forceResetActivity(t){this._forceResetActivity=t}get currentGpsData(){return this._currentGpsData}set currentGpsData(t){this._currentGpsData=t}get previousGpsData(){return this._previousGpsData}set previousGpsData(t){this._previousGpsData=t}get satellites(){return this._satellites}set satellites(t){this._satellites=t}get totalIncrements(){return this._totalIncrements}set totalIncrements(t){this._totalIncrements=t}get kilometerIncrements(){return this._kilometerIncrements}set kilometerIncrements(t){this._kilometerIncrements=t}get kilometerSpeed(){return this._kilometerSpeed}set kilometerSpeed(t){this._kilometerSpeed=t}get kilometerDistance(){return this._kilometerDistance}set kilometerDistance(t){this._kilometerDistance=t}get totalDistance(){return this._totalDistance}set totalDistance(t){this._totalDistance=t}get totalSpeed(){return this._totalSpeed}set totalSpeed(t){this._totalSpeed=t}get lastUpdatedTime(){return this._lastUpdatedTime}set lastUpdatedTime(t){this._lastUpdatedTime=t}get partialKilometerSpeed(){return this._partialKilometerSpeed}set partialKilometerSpeed(t){this._partialKilometerSpeed=t}get totalDuration(){return this._totalDuration}set totalDuration(t){this._totalDuration=t}get kilometerDuration(){return this._kilometerDuration}set kilometerDuration(t){this._kilometerDuration=t}get partialKilometerDuration(){return this._partialKilometerDuration}set partialKilometerDuration(t){this._partialKilometerDuration=t}get runningScreenData(){return this._runningScreenData}set runningScreenData(t){this._runningScreenData=t}}class i{static require(t){return require(t)}static g(){return g}static E(){return E}static setWatch(t,e,n){return setWatch(t,e,n)}static BTN1(){return BTN1}static BTN2(){return BTN2}static BTN3(){return BTN3}static BTN4(){return BTN4}static BTN5(){return BTN5}static Bangle(){return Bangle}}class c{}c.STEP_LENGTH_KM=8e-4,c.WEIGHT_KG=92,c.CALORIES_CALCULATOR_MET_RUNNING=9.8,c.CALORIES_CALCULATOR_MET_CYCLING=9.5,c.CALORIES_CALCULATOR_MET_SWIMMING=8,c.CALORIES_CALCULATOR_MET_WALKING=3.8;class o{static getDurationFormatted(t){const e=Math.round(t),n=Math.floor(e/3600),a=e%60;return(n?n+":":"")+("0"+Math.floor(e/60)%60).substr(-2)+":"+("0"+a).substr(-2)}static getDateFormatted(t){return("0"+t.getHours()).substr(-2)+":"+("0"+t.getMinutes()).substr(-2)}static getSpeedInKmH(t,e){return(e/t/3600).toFixed(1)}static getSpeedInMinKm(t,e){return(t/60/e).toFixed(1)}static getBurnedCalories(t,e,n){return(n*(60*t*3.5*e/200/3600)).toFixed(1)}}!function(t){t[t.Stop=63488]="Stop",t[t.Pause=65504]="Pause",t[t.Run=2016]="Run"}(s||(s={}));class l{static btn1Action(){i.Bangle().beep(),r.getInstance().forceResetActivity=!1,r.getInstance().activityState==e.Stop||r.getInstance().activityState==e.Pause?r.getInstance().activityState=e.Run:r.getInstance().activityState==e.Run&&(r.getInstance().activityState=e.Pause)}static btn3Action(){i.Bangle().beep(),r.getInstance().activityState==e.Stop&&(r.getInstance().forceResetActivity?r.getInstance().resetRunnigActivity():r.getInstance().forceResetActivity=!0)}static btn4Action(){r.getInstance().runningScreenData==a.Totals?r.getInstance().runningScreenData=a.Health:r.getInstance().runningScreenData==a.Health?r.getInstance().runningScreenData=a.Current:r.getInstance().runningScreenData==a.Current?r.getInstance().runningScreenData=a.Partial:r.getInstance().runningScreenData=a.Totals}static btn5Action(){r.getInstance().runningScreenData==a.Totals?r.getInstance().runningScreenData=a.Partial:r.getInstance().runningScreenData==a.Partial?r.getInstance().runningScreenData=a.Current:r.getInstance().runningScreenData==a.Current?r.getInstance().runningScreenData=a.Health:r.getInstance().runningScreenData=a.Totals}static drawScreen(){if(i.g().setColor(50712),i.g().setFont("6x8",2),i.g().setFontAlign(0,-1,0),i.g().drawString("DIST (KM)",60,32),i.g().drawString("TIME",180,32),i.g().setFontVector(30),i.g().setColor(65535),i.g().drawString(r.getInstance().totalDistance.toFixed(2),60,55),i.g().drawString(o.getDurationFormatted(r.getInstance().totalDuration),180,55),r.getInstance().runningScreenData==a.Totals){i.g().drawString("KM/H(gs)",55,152),i.g().drawString("MIN/KM(gs)",175,152),i.g().drawString("KM/H(gs)",55,152),i.g().drawString("MIN/KM(gs)",175,152);const t=r.getInstance().totalSpeed/r.getInstance().totalIncrements;i.g().drawString(t.toFixed(1),60,115),i.g().drawString((60/t).toFixed(1),180,115),i.g().drawString(o.getSpeedInKmH(r.getInstance().totalDuration,r.getInstance().totalDistance),60,175),i.g().drawString(o.getSpeedInMinKm(r.getInstance().totalDuration,r.getInstance().totalDistance),180,175)}else if(r.getInstance().runningScreenData==a.Partial)i.g().drawString("KM/H(ps)",55,152),i.g().drawString("MIN/KM(ps)",175,152),i.g().drawString("KM/H(ps)",55,152),i.g().drawString("MIN/KM(ps)",175,152),i.g().drawString(r.getInstance().partialKilometerSpeed.toFixed(1),60,115),i.g().drawString((60/r.getInstance().partialKilometerSpeed).toFixed(1),180,115),i.g().drawString(o.getSpeedInKmH(r.getInstance().partialKilometerDuration,1),60,175),i.g().drawString(o.getSpeedInMinKm(r.getInstance().partialKilometerDuration,1),180,175);else if(r.getInstance().runningScreenData==a.Current){i.g().drawString("KM/H(cs)",55,152),i.g().drawString("MIN/KM(cs)",175,152),i.g().drawString("KM/H(cs)",55,152),i.g().drawString("MIN/KM(cs)",175,152);const t=r.getInstance().kilometerSpeed/r.getInstance().kilometerIncrements;i.g().drawString(t.toFixed(1),60,115),i.g().drawString((60/t).toFixed(1),180,115),i.g().drawString(o.getSpeedInKmH(r.getInstance().kilometerDuration,r.getInstance().kilometerDistance),60,175),i.g().drawString(o.getSpeedInMinKm(r.getInstance().kilometerDuration,r.getInstance().kilometerDistance),180,175)}else r.getInstance().runningScreenData==a.Health&&(i.g().drawString("STEPS (KM)",60,92),i.g().drawString("SPEED",180,92),i.g().drawString("HEART",55,152),i.g().drawString("CAL",175,152),i.g().drawString((c.STEP_LENGTH_KM*r.getInstance().steps).toFixed(2),60,115),i.g().drawString(r.getInstance().speed.toFixed(1),180,115),i.g().drawString((0).toFixed(0),60,175),i.g().drawString(o.getBurnedCalories(c.CALORIES_CALCULATOR_MET_RUNNING,c.WEIGHT_KG,r.getInstance().totalDuration),180,175));i.g().setFont("6x8",2),i.g().setColor(r.getInstance().stateGps?2016:63488),i.g().fillRect(0,216,80,240),i.g().setColor(0),i.g().drawString("GPS",33,220),i.g().setFont("6x8",1),i.g().drawString("("+r.getInstance().satellites.toFixed(0)+")",63,225),i.g().setFont("6x8",2),i.g().setColor(65535),i.g().fillRect(80,216,160,240),i.g().setColor(0),i.g().drawString(o.getDateFormatted(new Date),120,220),i.g().setColor(l.getColorFromActivityState()),i.g().fillRect(160,216,240,240),i.g().setColor(0),i.g().drawString(l.getLabelFromActivityState(),200,220)}static manageBtnAction(e){e==t.BTN1?l.btn1Action():e==t.BTN3?l.btn3Action():e==t.BTN4?l.btn4Action():e==t.BTN5&&l.btn5Action()}static getColorFromActivityState(){return r.getInstance().activityState==e.Run?s.Run:r.getInstance().activityState==e.Pause?s.Pause:s.Stop}static getLabelFromActivityState(){return r.getInstance().activityState==e.Run?"RUN":r.getInstance().activityState==e.Pause?"PAUSE":"STOP"}}class u{static manageBtnAction(e){r.getInstance().stateGps||(e==t.BTN2?u.nextScreen():r.getInstance().screenType==n.Running&&l.manageBtnAction(e))}static nextScreen(){r.getInstance().screenType==n.Running?r.getInstance().screenType=n.Heart:r.getInstance().screenType==n.Heart?r.getInstance().screenType=n.Map:r.getInstance().screenType=n.Running,u.drawScreen()}static drawScreen(){i.g().clear(),i.Bangle().drawWidgets(),l.drawScreen(),i.g().flip()}}class p{static processGPSResponse(t){if(!r.getInstance().stateGps&&t.fix&&(i.Bangle().beep(),i.Bangle().buzz(),r.getInstance().stateGps=!0),t.fix&&r.getInstance().activityState==e.Run&&r.getInstance().previousGpsData){const e=Date.now(),n=(e-r.getInstance().lastUpdatedTime)/1e3;r.getInstance().lastUpdatedTime=e,r.getInstance().previousGpsData=r.getInstance().currentGpsData,r.getInstance().currentGpsData=t,r.getInstance().speed=r.getInstance().currentGpsData.speed;const a=p.distanceInKmBetweenEarthCoordinates(r.getInstance().previousGpsData.lat,r.getInstance().previousGpsData.lon,r.getInstance().currentGpsData.lat,r.getInstance().currentGpsData.lon);r.getInstance().totalIncrements++,r.getInstance().totalDistance+=a,r.getInstance().totalSpeed+=r.getInstance().currentGpsData.speed,r.getInstance().totalDuration+=n,r.getInstance().kilometerIncrements++,r.getInstance().kilometerDistance+=a,r.getInstance().kilometerSpeed+=r.getInstance().currentGpsData.speed,r.getInstance().kilometerDuration+=n,r.getInstance().kilometerDistance>1&&(r.getInstance().partialKilometerSpeed=r.getInstance().kilometerSpeed/r.getInstance().kilometerIncrements,r.getInstance().partialKilometerDuration=r.getInstance().kilometerDuration,r.getInstance().kilometerDuration=0,r.getInstance().kilometerSpeed=0,r.getInstance().kilometerDistance=0,r.getInstance().kilometerIncrements=0)}u.drawScreen()}static convertDegreesToRadians(t){return t*Math.PI/180}static distanceInKmBetweenEarthCoordinates(t,e,n,a){const s=p.convertDegreesToRadians(n-t),r=p.convertDegreesToRadians(a-e);t=p.convertDegreesToRadians(t),n=p.convertDegreesToRadians(n);const i=Math.sin(s/2)*Math.sin(s/2)+Math.sin(r/2)*Math.sin(r/2)*Math.cos(t)*Math.cos(n);return 6371.0088*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}}i.Bangle().setLCDMode("doublebuffered"),i.E().showMessage("Loading..."),u.drawScreen(),i.setWatch(()=>u.manageBtnAction(t.BTN1),i.BTN1(),{repeat:!0,edge:"falling"}),i.setWatch(()=>u.manageBtnAction(t.BTN2),i.BTN2(),{repeat:!0,edge:"falling"}),i.setWatch(()=>u.manageBtnAction(t.BTN3),i.BTN3(),{repeat:!0,edge:"falling"}),i.setWatch(()=>u.manageBtnAction(t.BTN4),i.BTN4(),{repeat:!0,edge:"falling"}),i.setWatch(()=>u.manageBtnAction(t.BTN5),i.BTN5(),{repeat:!0,edge:"falling"}),i.Bangle().on("GPS",t=>p.processGPSResponse(t)),i.Bangle().on("Step",t=>class{static processStepResponse(){r.getInstance().activityState==e.Run&&r.getInstance().steps++,u.drawScreen()}}.processStepResponse()),i.Bangle().setGPSPower(1)}();
